{"version":3,"file":"taiga-ui-kit-directives-lazy-loading.mjs","sources":["../../../projects/kit/directives/lazy-loading/lazy-loading.service.ts","../../../projects/kit/directives/lazy-loading/lazy-loading.directive.ts","../../../projects/kit/directives/lazy-loading/taiga-ui-kit-directives-lazy-loading.ts"],"sourcesContent":["import {inject, Injectable} from '@angular/core';\nimport type {SafeResourceUrl} from '@angular/platform-browser';\nimport {IntersectionObserverService} from '@ng-web-apis/intersection-observer';\nimport {tuiWatch} from '@taiga-ui/cdk/observables';\nimport {filter, map, Observable, Subject, switchMap, take} from 'rxjs';\n\n@Injectable()\nexport class TuiLazyLoadingService extends Observable<SafeResourceUrl | string> {\n    private readonly src$ = new Subject<SafeResourceUrl | string>();\n    private readonly intersections$ = inject(IntersectionObserverService);\n    private readonly stream$ = this.src$.pipe(\n        switchMap((src) =>\n            this.intersections$.pipe(\n                filter((entry) => !!entry[0]?.isIntersecting),\n                map(() => src),\n                take(1),\n            ),\n        ),\n        tuiWatch(),\n    );\n\n    constructor() {\n        super((subscriber) => this.stream$.subscribe(subscriber));\n    }\n\n    public next(src: SafeResourceUrl | string): void {\n        this.src$.next(src);\n    }\n}\n","import {isPlatformServer} from '@angular/common';\nimport {Directive, inject, Input, PLATFORM_ID, signal} from '@angular/core';\nimport {takeUntilDestroyed} from '@angular/core/rxjs-interop';\nimport type {SafeResourceUrl} from '@angular/platform-browser';\nimport {IntersectionObserverService} from '@ng-web-apis/intersection-observer';\nimport {tuiInjectElement} from '@taiga-ui/cdk/utils/dom';\n\nimport {TuiLazyLoadingService} from './lazy-loading.service';\n\n/**\n * @deprecated: Drop in v5.0\n */\n@Directive({\n    standalone: true,\n    selector: 'img[loading=\"lazy\"],img[tuiLoading=\"lazy\"]',\n    providers: [TuiLazyLoadingService, IntersectionObserverService],\n    host: {\n        '[style.animation]': 'animation()',\n        '[style.background]': 'background()',\n        '[attr.loading]': 'supported ? \"lazy\" : null',\n        '[attr.src]': 'src()',\n        '(load)': 'unset()',\n        '(error)': 'unset()',\n    },\n})\nexport class TuiImgLazyLoading {\n    private readonly isServer = isPlatformServer(inject(PLATFORM_ID));\n    private readonly loading$ = inject(TuiLazyLoadingService);\n    protected readonly supported = 'loading' in tuiInjectElement<HTMLImageElement>();\n    protected src = signal<SafeResourceUrl | string | null>(null);\n    protected background = signal(this.isServer ? '' : 'var(--tui-background-neutral-2)');\n    protected animation = signal(\n        this.isServer ? '' : 'tuiSkeletonVibe ease-in-out 1s infinite alternate',\n    );\n\n    protected readonly $ =\n        !this.supported &&\n        this.loading$.pipe(takeUntilDestroyed()).subscribe((src) => this.src.set(src));\n\n    @Input('src')\n    public set srcSetter(src: SafeResourceUrl | string) {\n        if (this.supported) {\n            this.src.set(src);\n        } else {\n            this.loading$.next(src);\n        }\n    }\n\n    protected unset(): void {\n        this.background.set('');\n        this.animation.set('');\n    }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}