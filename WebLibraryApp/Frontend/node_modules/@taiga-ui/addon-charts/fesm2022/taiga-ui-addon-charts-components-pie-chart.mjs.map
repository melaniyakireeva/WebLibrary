{"version":3,"file":"taiga-ui-addon-charts-components-pie-chart.mjs","sources":["../../../projects/addon-charts/components/pie-chart/pie-chart.directive.ts","../../../projects/addon-charts/components/pie-chart/pie-chart.component.ts","../../../projects/addon-charts/components/pie-chart/pie-chart.template.html","../../../projects/addon-charts/components/pie-chart/taiga-ui-addon-charts-components-pie-chart.ts"],"sourcesContent":["import {Directive, inject, Input} from '@angular/core';\nimport {takeUntilDestroyed} from '@angular/core/rxjs-interop';\nimport {WA_ANIMATION_FRAME, WA_PERFORMANCE} from '@ng-web-apis/common';\nimport {tuiDescribeSector} from '@taiga-ui/addon-charts/utils';\nimport {tuiZonefree} from '@taiga-ui/cdk/observables';\nimport {tuiInjectElement} from '@taiga-ui/cdk/utils/dom';\nimport {tuiClamp} from '@taiga-ui/cdk/utils/math';\nimport {tuiEaseInOutQuad} from '@taiga-ui/cdk/utils/miscellaneous';\nimport {TUI_ANIMATIONS_SPEED} from '@taiga-ui/core/tokens';\nimport {tuiGetDuration} from '@taiga-ui/core/utils/miscellaneous';\nimport {BehaviorSubject, map, pairwise, switchMap, takeWhile} from 'rxjs';\n\n@Directive({\n    standalone: true,\n    selector: 'path[tuiPieChart]',\n})\nexport class TuiPieChartDirective {\n    private readonly sector$ = new BehaviorSubject<readonly [number, number]>([0, 0]);\n    private readonly el = tuiInjectElement<SVGPathElement>();\n    private readonly performance = inject(WA_PERFORMANCE);\n    private readonly animationFrame$ = inject(WA_ANIMATION_FRAME);\n    private readonly speed = inject(TUI_ANIMATIONS_SPEED);\n    protected readonly $ = this.sector$\n        .pipe(\n            pairwise(),\n            switchMap(([prev, cur]) => {\n                const now = this.performance.now();\n                const startDelta = cur[0] - prev[0];\n                const endDelta = cur[1] - prev[1];\n\n                return this.animationFrame$.pipe(\n                    map((timestamp) =>\n                        tuiEaseInOutQuad(\n                            tuiClamp(\n                                (timestamp - now) / tuiGetDuration(this.speed),\n                                0,\n                                1,\n                            ),\n                        ),\n                    ),\n                    takeWhile((progress) => progress < 1, true),\n                    map((progress) => [\n                        prev[0] + startDelta * progress,\n                        cur[1] > 359 ? cur[1] : prev[1] + endDelta * progress,\n                    ]),\n                );\n            }),\n            tuiZonefree(),\n            takeUntilDestroyed(),\n        )\n        .subscribe(([start, end]) =>\n            this.el.setAttribute('d', tuiDescribeSector(start, end)),\n        );\n\n    @Input()\n    public set tuiPieChart(sector: readonly [number, number]) {\n        this.sector$.next(sector);\n    }\n}\n","import {\n    ChangeDetectionStrategy,\n    Component,\n    EventEmitter,\n    inject,\n    Input,\n    Output,\n} from '@angular/core';\nimport {TuiHovered} from '@taiga-ui/cdk/directives/hovered';\nimport {TuiRepeatTimes} from '@taiga-ui/cdk/directives/repeat-times';\nimport {tuiInjectId} from '@taiga-ui/cdk/services';\nimport type {TuiContext} from '@taiga-ui/cdk/types';\nimport {tuiSum} from '@taiga-ui/cdk/utils/math';\nimport {tuiPure} from '@taiga-ui/cdk/utils/miscellaneous';\nimport {\n    TuiHint,\n    TuiHintOptionsDirective,\n    tuiHintOptionsProvider,\n} from '@taiga-ui/core/directives/hint';\nimport type {TuiSizeXL, TuiSizeXS} from '@taiga-ui/core/types';\nimport type {PolymorpheusContent} from '@taiga-ui/polymorpheus';\n\nimport {TuiPieChartDirective} from './pie-chart.directive';\n\nconst RADII = {\n    xs: '50',\n    s: '50',\n    m: '77.8',\n    l: '81.9',\n    xl: '81.3',\n};\nconst TRANSFORM = {\n    xs: 1.15,\n    s: 1.25,\n    m: 1.11,\n    l: 1.09,\n    xl: 1.08,\n};\n\n@Component({\n    standalone: true,\n    selector: 'tui-pie-chart',\n    imports: [TuiHint, TuiHovered, TuiPieChartDirective, TuiRepeatTimes],\n    templateUrl: './pie-chart.template.html',\n    styleUrls: ['./pie-chart.style.less'],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n    viewProviders: [tuiHintOptionsProvider({direction: 'top-right', appearance: 'dark'})],\n    host: {\n        '[attr.data-size]': 'size',\n        '[class._empty]': 'empty',\n    },\n})\nexport class TuiPieChart {\n    private readonly hintOptions = inject(TuiHintOptionsDirective, {optional: true});\n    private readonly autoId = tuiInjectId();\n\n    @Input()\n    public value: readonly number[] = [];\n\n    @Input()\n    public size: TuiSizeXL | TuiSizeXS = 'm';\n\n    @Input()\n    public masked = false;\n\n    @Input()\n    public activeItemIndex = NaN;\n\n    @Output()\n    public readonly activeItemIndexChange = new EventEmitter<number>();\n\n    constructor() {\n        if (this.hintOptions) {\n            this.hintOptions.showDelay = 0;\n            this.hintOptions.hideDelay = 0;\n        }\n    }\n\n    protected get empty(): boolean {\n        return !this.getSum(this.value);\n    }\n\n    protected get hintContent(): PolymorpheusContent<TuiContext<number>> {\n        return this.hintOptions?.content || '';\n    }\n\n    protected get maskId(): string {\n        return `tui-ring-chart-${this.autoId}`;\n    }\n\n    protected get mask(): string | null {\n        return this.masked ? `url(#${this.maskId})` : null;\n    }\n\n    protected get radius(): string {\n        return RADII[this.size];\n    }\n\n    protected get segments(): ReadonlyArray<[number, number]> {\n        return this.getSegments(this.value);\n    }\n\n    protected getTransform(index: number): string | null {\n        const transform = this.masked\n            ? `scale(${TRANSFORM[this.size]})`\n            : `scale(${TRANSFORM.xs})`;\n\n        return index === this.activeItemIndex ? transform : null;\n    }\n\n    protected onHovered(hovered: boolean, index: number): void {\n        this.updateActiveItemIndex(hovered ? index : NaN);\n    }\n\n    @tuiPure\n    private getSum(value: readonly number[]): number {\n        return tuiSum(...value);\n    }\n\n    @tuiPure\n    private getSegments(value: readonly number[]): ReadonlyArray<[number, number]> {\n        return value\n            .map((initial, i, array) =>\n                array.reduce(\n                    (sum, current, j) => (j < i ? this.getDeg(current) + sum : sum),\n                    this.getDeg(initial),\n                ),\n            )\n            .map((angle, index, array) => [\n                array[index - 1] || 0,\n                Math.min(angle, 359.9999),\n            ]);\n    }\n\n    private getDeg(value: number): number {\n        return 360 * (value / this.getSum(this.value)) || 0;\n    }\n\n    private updateActiveItemIndex(index: number): void {\n        if (index === this.activeItemIndex) {\n            return;\n        }\n\n        this.activeItemIndex = index;\n        this.activeItemIndexChange.next(index);\n    }\n}\n","<svg\n    focusable=\"false\"\n    height=\"100%\"\n    viewBox=\"-100 -100 200 200\"\n    width=\"100%\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    class=\"t-svg\"\n>\n    <defs>\n        <mask [attr.id]=\"maskId\">\n            <rect\n                fill=\"white\"\n                height=\"400\"\n                width=\"400\"\n                x=\"-200\"\n                y=\"-200\"\n            />\n            <circle\n                cx=\"0\"\n                cy=\"0\"\n                [attr.r]=\"radius\"\n            />\n        </mask>\n    </defs>\n    <g [style.mask]=\"mask\">\n        <circle\n            cx=\"0\"\n            cy=\"0\"\n            r=\"100\"\n            class=\"t-placeholder\"\n        />\n        <path\n            *tuiRepeatTimes=\"let index of segments.length\"\n            automation-id=\"tui-pie-chart__segment\"\n            d=\"\"\n            fill=\"currentColor\"\n            tuiHintPointer\n            class=\"t-segment\"\n            [attr.transform]=\"getTransform(index)\"\n            [style.color]=\"'var(--tui-chart-categorical-0' + index + ')'\"\n            [tuiHint]=\"hintContent\"\n            [tuiHintContext]=\"{$implicit: index}\"\n            [tuiPieChart]=\"segments[index] || [0, 0]\"\n            (tuiHoveredChange)=\"onHovered($event, index)\"\n        />\n    </g>\n</svg>\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}