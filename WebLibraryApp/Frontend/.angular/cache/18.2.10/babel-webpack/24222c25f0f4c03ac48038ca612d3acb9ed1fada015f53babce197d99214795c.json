{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"./analytics-page.component.html?ngResource\";\nimport __NG_CLI_RESOURCE__1 from \"./analytics-page.component.scss?ngResource\";\nimport { ChangeDetectorRef, Component } from '@angular/core';\nimport { EkbTableService } from '../../services/ekb-table/ekb-table.service';\nimport { AuthorService } from '../../services/author/author-service.service';\nimport { NgIf } from '@angular/common';\nimport { TuiRingChart } from '@taiga-ui/addon-charts';\nimport { CategoryService } from '../../services/category/category.service';\nimport _ from 'lodash';\nimport { TuiTabs } from '@taiga-ui/kit';\nimport { FormsModule } from '@angular/forms';\nimport { TuiAxes, TuiBarChart } from '@taiga-ui/addon-charts';\nimport { TuiHint } from '@taiga-ui/core';\nimport { TuiDataListWrapper } from '@taiga-ui/kit';\nimport { TuiSelectModule } from '@taiga-ui/legacy';\nlet that = {};\nlet AnalyticsPageComponent = class AnalyticsPageComponent {\n  ekbService;\n  manufactureService;\n  categoryService;\n  cdRef;\n  ekbElementsCount = 0;\n  manufacturersCount = 0;\n  tabSelectedElement = 0;\n  labels = [];\n  labelsY = [];\n  value = [];\n  total = 0;\n  max = 0;\n  barValues = [];\n  index = NaN;\n  get sum() {\n    return (Number.isNaN(this.index) ? this.total : this.value[this.index]) ?? 0;\n  }\n  get label() {\n    return (Number.isNaN(this.index) ? 'всего' : this.labels[this.index]) ?? '';\n  }\n  constructor(ekbService, manufactureService, categoryService, cdRef) {\n    this.ekbService = ekbService;\n    this.manufactureService = manufactureService;\n    this.categoryService = categoryService;\n    this.cdRef = cdRef;\n    that = this;\n  }\n  ngOnInit() {\n    const paging = {\n      pageIndex: 0,\n      itemsPerPage: 1\n    };\n    const emptyFilter = {\n      paging: paging,\n      scopeParams: null,\n      sortInfo: null,\n      filterOperations: null\n    };\n    this.ekbService.getEkbElements(emptyFilter).subscribe(x => {\n      this.ekbElementsCount = x.totalCount;\n      this.cdRef.markForCheck();\n    });\n    this.categoryService.getElementsPerCategory().subscribe(x => {\n      this.labels = _.keys(x);\n      this.value = _.map(this.labels, key => x[key]);\n      this.total = _.sum(this.value);\n      this.labelsY = [];\n      this.max = Math.max(...this.value);\n      let step = Math.floor(this.max / 10);\n      for (let i = 0; i <= 10; i++) {\n        this.labelsY.push((i * step).toString());\n      }\n      this.barValues.push(this.value);\n      this.cdRef.markForCheck();\n    });\n    this.manufactureService.getAuthors(emptyFilter).subscribe(x => {\n      this.manufacturersCount = x.totalCount;\n      this.cdRef.markForCheck();\n    });\n  }\n  hint = ({\n    $implicit\n  }) => {\n    const label = this.labels[$implicit];\n    return `${label}: ${this.value[$implicit]}`;\n  };\n  static ctorParameters = () => [{\n    type: EkbTableService\n  }, {\n    type: AuthorService\n  }, {\n    type: CategoryService\n  }, {\n    type: ChangeDetectorRef\n  }];\n};\nAnalyticsPageComponent = __decorate([Component({\n  selector: 'app-analytics-page',\n  standalone: true,\n  imports: [TuiRingChart, TuiTabs, NgIf, FormsModule, TuiBarChart, TuiDataListWrapper, TuiHint, TuiAxes, TuiSelectModule],\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], AnalyticsPageComponent);\nexport { AnalyticsPageComponent };","map":{"version":3,"names":["ChangeDetectorRef","Component","EkbTableService","AuthorService","NgIf","TuiRingChart","CategoryService","_","TuiTabs","FormsModule","TuiAxes","TuiBarChart","TuiHint","TuiDataListWrapper","TuiSelectModule","that","AnalyticsPageComponent","ekbService","manufactureService","categoryService","cdRef","ekbElementsCount","manufacturersCount","tabSelectedElement","labels","labelsY","value","total","max","barValues","index","NaN","sum","Number","isNaN","label","constructor","ngOnInit","paging","pageIndex","itemsPerPage","emptyFilter","scopeParams","sortInfo","filterOperations","getEkbElements","subscribe","x","totalCount","markForCheck","getElementsPerCategory","keys","map","key","Math","step","floor","i","push","toString","getAuthors","hint","$implicit","__decorate","selector","standalone","imports","template","__NG_CLI_RESOURCE__0"],"sources":["C:\\Users\\Asus-PC\\Downloads\\WebLibraryNew\\WebLibrary\\WebLibraryApp\\Frontend\\src\\app\\components\\analytics-page\\analytics-page.component.ts"],"sourcesContent":["import { ChangeDetectorRef, Component, OnInit } from '@angular/core';\r\nimport { EkbTableService } from '../../services/ekb-table/ekb-table.service';\r\nimport { AuthorService } from '../../services/author/author-service.service';\r\nimport { BaseFilter, Paging } from '../../services/filters/filters';\r\nimport { AsyncPipe, NgIf } from '@angular/common';\r\nimport { TuiRingChart } from '@taiga-ui/addon-charts';\r\nimport { CategoryService } from '../../services/category/category.service';\r\nimport _ from 'lodash';\r\nimport { TuiTabs } from '@taiga-ui/kit';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { TuiAxes, TuiBarChart } from '@taiga-ui/addon-charts';\r\nimport type { TuiContext } from '@taiga-ui/cdk';\r\nimport { tuiFormatNumber, TuiHint } from '@taiga-ui/core';\r\nimport { TuiDataListWrapper } from '@taiga-ui/kit';\r\nimport { TuiSelectModule } from '@taiga-ui/legacy';\r\n\r\nlet that: any = {};\r\n\r\n@Component({\r\n  selector: 'app-analytics-page',\r\n  standalone: true,\r\n  imports: [\r\n    TuiRingChart,\r\n    TuiTabs,\r\n    NgIf,\r\n    FormsModule,\r\n    TuiBarChart,\r\n    TuiDataListWrapper,\r\n    TuiHint,\r\n    TuiAxes,\r\n    TuiSelectModule,\r\n  ],\r\n  templateUrl: './analytics-page.component.html',\r\n  styleUrl: './analytics-page.component.scss',\r\n})\r\nexport class AnalyticsPageComponent implements OnInit {\r\n  ekbElementsCount: number = 0;\r\n  manufacturersCount: number = 0;\r\n\r\n  tabSelectedElement: number = 0;\r\n\r\n  protected labels: string[] = [];\r\n  protected labelsY: string[] = [];\r\n  protected value: number[] = [];\r\n  protected total = 0;\r\n  protected max: number = 0;\r\n\r\n  protected barValues: number[][] = [];\r\n  protected index = NaN;\r\n\r\n  protected get sum(): number {\r\n    return (\r\n      (Number.isNaN(this.index) ? this.total : this.value[this.index]) ?? 0\r\n    );\r\n  }\r\n\r\n  protected get label(): string {\r\n    return (Number.isNaN(this.index) ? 'всего' : this.labels[this.index]) ?? '';\r\n  }\r\n\r\n  constructor(\r\n    private ekbService: EkbTableService,\r\n    private manufactureService: AuthorService,\r\n    private categoryService: CategoryService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {\r\n    that = this;\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    const paging: Paging = {\r\n      pageIndex: 0,\r\n      itemsPerPage: 1,\r\n    };\r\n\r\n    const emptyFilter: BaseFilter = {\r\n      paging: paging,\r\n      scopeParams: null,\r\n      sortInfo: null,\r\n      filterOperations: null,\r\n    };\r\n\r\n    this.ekbService.getEkbElements(emptyFilter).subscribe((x) => {\r\n      this.ekbElementsCount = x.totalCount;\r\n      this.cdRef.markForCheck();\r\n    });\r\n\r\n    this.categoryService.getElementsPerCategory().subscribe((x) => {\r\n      this.labels = _.keys(x);\r\n      this.value = _.map(this.labels, (key) => x[key]);\r\n      this.total = _.sum(this.value);\r\n      this.labelsY = [];\r\n      this.max = Math.max(...this.value);\r\n      let step = Math.floor(this.max / 10);\r\n      for (let i = 0; i <= 10; i++) {\r\n        this.labelsY.push((i * step).toString());\r\n      }\r\n\r\n      this.barValues.push(this.value);\r\n\r\n      this.cdRef.markForCheck();\r\n    });\r\n\r\n    this.manufactureService.getAuthors(emptyFilter).subscribe((x) => {\r\n      this.manufacturersCount = x.totalCount;\r\n      this.cdRef.markForCheck();\r\n    });\r\n  }\r\n\r\n  hint = ({ $implicit }: TuiContext<number>): string => {\r\n    const label = this.labels[$implicit];\r\n    return `${label}: ${this.value[$implicit]}`;\r\n  }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}