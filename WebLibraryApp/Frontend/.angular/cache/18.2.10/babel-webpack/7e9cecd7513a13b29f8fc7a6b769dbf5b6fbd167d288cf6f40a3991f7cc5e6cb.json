{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"./edit-account.component.html?ngResource\";\nimport __NG_CLI_RESOURCE__1 from \"./edit-account.component.scss?ngResource\";\nimport { ChangeDetectionStrategy, Component, inject } from '@angular/core';\nimport { TuiIcon, TuiTextfield, TuiButton, TuiLink } from '@taiga-ui/core';\nimport { TuiTooltip, TuiPassword, TuiFiles, TuiAvatar } from '@taiga-ui/kit';\nimport { RouterLink, RouterLinkActive } from '@angular/router';\nimport _ from 'lodash';\nimport { catchError, finalize, map, of, Subject, switchMap } from 'rxjs';\nimport { FormControl, FormsModule, ReactiveFormsModule, Validators } from '@angular/forms';\nimport { CommonModule } from '@angular/common';\nimport { injectContext } from '@taiga-ui/polymorpheus';\nimport { FilesUploaderService } from '../../services/files/files-uploader.service';\nlet EditAccountComponent = class EditAccountComponent {\n  error;\n  isRegisterProcess = false;\n  email;\n  name;\n  surname;\n  login;\n  fileService = inject(FilesUploaderService);\n  fileId;\n  fileControl = new FormControl(null, Validators.required);\n  context = injectContext();\n  get oldAccountInfo() {\n    return this.context.data;\n  }\n  submit() {\n    const newInfo = {\n      email: this.email ?? this.oldAccountInfo.email,\n      name: this.name ?? this.oldAccountInfo.name,\n      surname: this.surname ?? this.oldAccountInfo.surname,\n      login: this.login ?? this.oldAccountInfo.login,\n      id: this.oldAccountInfo.id,\n      organization: this.oldAccountInfo.organization,\n      profileIconId: this.fileId ?? this.oldAccountInfo.profileIconId\n    };\n    if (!_.isNil(newInfo)) {\n      this.context.completeWith(newInfo);\n    }\n  }\n  failedFiles$ = new Subject();\n  loadingFiles$ = new Subject();\n  loadedFiles$ = this.fileControl.valueChanges.pipe(switchMap(file => this.processFile(file)));\n  removeFile() {\n    this.fileControl.setValue(null);\n  }\n  processFile(file) {\n    this.failedFiles$.next(null);\n    if (this.fileControl.invalid || !file) {\n      return of(null);\n    }\n    this.loadingFiles$.next(file);\n    const formData = new FormData();\n    formData.append('file', file, file.name);\n    return this.fileService.uploadFile(formData).pipe(map(x => {\n      this.fileId = x;\n      return file;\n    }), catchError(x => {\n      this.failedFiles$.next(file);\n      return of(null);\n    }), finalize(() => this.loadingFiles$.next(null)));\n  }\n  onSaveClick() {\n    this.submit();\n  }\n};\nEditAccountComponent = __decorate([Component({\n  selector: 'app-edit-account',\n  standalone: true,\n  imports: [TuiTextfield, TuiIcon, TuiTooltip, TuiPassword, TuiButton, RouterLink, RouterLinkActive, FormsModule, CommonModule, TuiFiles, ReactiveFormsModule, TuiAvatar, TuiLink],\n  template: __NG_CLI_RESOURCE__0,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  styles: [__NG_CLI_RESOURCE__1]\n})], EditAccountComponent);\nexport { EditAccountComponent };","map":{"version":3,"names":["ChangeDetectionStrategy","Component","inject","TuiIcon","TuiTextfield","TuiButton","TuiLink","TuiTooltip","TuiPassword","TuiFiles","TuiAvatar","RouterLink","RouterLinkActive","_","catchError","finalize","map","of","Subject","switchMap","FormControl","FormsModule","ReactiveFormsModule","Validators","CommonModule","injectContext","FilesUploaderService","EditAccountComponent","error","isRegisterProcess","email","name","surname","login","fileService","fileId","fileControl","required","context","oldAccountInfo","data","submit","newInfo","id","organization","profileIconId","isNil","completeWith","failedFiles$","loadingFiles$","loadedFiles$","valueChanges","pipe","file","processFile","removeFile","setValue","next","invalid","formData","FormData","append","uploadFile","x","onSaveClick","__decorate","selector","standalone","imports","template","__NG_CLI_RESOURCE__0","changeDetection","OnPush"],"sources":["C:\\Users\\Asus-PC\\Downloads\\WebLibraryNew\\WebLibrary\\WebLibraryApp\\Frontend\\src\\app\\components\\edit-account\\edit-account.component.ts"],"sourcesContent":["import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  inject,\r\n  OnInit,\r\n} from '@angular/core';\r\nimport {\r\n  TuiIcon,\r\n  TuiTextfield,\r\n  TuiButton,\r\n  TuiDialogContext,\r\n  TuiLink,\r\n} from '@taiga-ui/core';\r\nimport { TuiTooltip, TuiPassword, TuiFiles, TuiFileLike, TuiAvatar } from '@taiga-ui/kit';\r\nimport {\r\n  NavigationEnd,\r\n  Router,\r\n  RouterLink,\r\n  RouterLinkActive,\r\n  RouterOutlet,\r\n} from '@angular/router';\r\nimport _ from 'lodash';\r\nimport {\r\n  AuthService,\r\n  RegisterDto,\r\n} from '../../services/auth/auth-service.service';\r\nimport { catchError, finalize, map, Observable, of, Subject, switchMap, tap, timer } from 'rxjs';\r\nimport { FormControl, FormsModule, ReactiveFormsModule, Validators } from '@angular/forms';\r\nimport { CommonModule } from '@angular/common';\r\nimport { injectContext } from '@taiga-ui/polymorpheus';\r\nimport { AccountFullInfo } from '../../services/messages/room-service.service';\r\nimport { FilesUploaderService } from '../../services/files/files-uploader.service';\r\n\r\n@Component({\r\n  selector: 'app-edit-account',\r\n  standalone: true,\r\n  imports: [\r\n    TuiTextfield,\r\n    TuiIcon,\r\n    TuiTooltip,\r\n    TuiPassword,\r\n    TuiButton,\r\n    RouterLink,\r\n    RouterLinkActive,\r\n    FormsModule,\r\n    CommonModule,\r\n    TuiFiles,\r\n    ReactiveFormsModule,\r\n    TuiAvatar,\r\n    TuiLink,\r\n  ],\r\n  templateUrl: './edit-account.component.html',\r\n  styleUrl: './edit-account.component.scss',\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class EditAccountComponent {\r\n  error?: string;\r\n  isRegisterProcess: boolean = false;\r\n  email?: string;\r\n  name?: string;\r\n  surname?: string;\r\n  login?: string;\r\n  fileService: FilesUploaderService = inject(FilesUploaderService);\r\n  fileId?: number;\r\n\r\n  protected readonly fileControl = new FormControl<TuiFileLike | null>(\r\n    null,\r\n    Validators.required\r\n  );\r\n\r\n  public readonly context =\r\n    injectContext<TuiDialogContext<AccountFullInfo, AccountFullInfo>>();\r\n\r\n  public get oldAccountInfo(): AccountFullInfo {\r\n    return this.context.data;\r\n  }\r\n\r\n  protected submit(): void {\r\n    const newInfo: AccountFullInfo = {\r\n      email: this.email ?? this.oldAccountInfo.email,\r\n      name: this.name ?? this.oldAccountInfo.name,\r\n      surname: this.surname ?? this.oldAccountInfo.surname,\r\n      login: this.login ?? this.oldAccountInfo.login,\r\n      id: this.oldAccountInfo.id,\r\n      organization: this.oldAccountInfo.organization,\r\n      profileIconId: this.fileId ?? this.oldAccountInfo.profileIconId,\r\n    };\r\n\r\n    if (!_.isNil(newInfo)) {\r\n      this.context.completeWith(newInfo);\r\n    }\r\n  }\r\n\r\n  protected readonly failedFiles$ = new Subject<TuiFileLike | null>();\r\n  protected readonly loadingFiles$ = new Subject<TuiFileLike | null>();\r\n  protected readonly loadedFiles$ = this.fileControl.valueChanges.pipe(\r\n    switchMap((file) => this.processFile(file))\r\n  );\r\n\r\n  protected removeFile(): void {\r\n    this.fileControl.setValue(null);\r\n  }\r\n\r\n  protected processFile(\r\n    file: TuiFileLike | null\r\n  ): Observable<TuiFileLike | null> {\r\n    this.failedFiles$.next(null);\r\n\r\n    if (this.fileControl.invalid || !file) {\r\n      return of(null);\r\n    }\r\n\r\n    this.loadingFiles$.next(file);\r\n\r\n    const formData = new FormData();\r\n    formData.append('file', <File>file, file.name);\r\n\r\n    return this.fileService.uploadFile(formData).pipe(\r\n      map((x) => {\r\n        this.fileId = x;\r\n        return file;\r\n      }),\r\n      catchError((x) => {\r\n        this.failedFiles$.next(file);\r\n        return of(null);\r\n      }),\r\n      finalize(() => this.loadingFiles$.next(null))\r\n    );\r\n  }\r\n\r\n  protected onSaveClick() {\r\n    this.submit();\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}